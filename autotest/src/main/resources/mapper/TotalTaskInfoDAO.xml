<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.tdw.dao.TotalTaskInfoDAO">




    <sql id="TotalTaskInfoColumn">
		id,tracker_id,task_count,task_amount,repay_count,repay_count_percent,repay_amount,repay_amount_percent,
		remark,create_time,update_time,is_deleted
	</sql>

    <select id="queryTraceDetailTotal" resultType="cn.tdw.dto.TraceDetailTotalDTO">
        SELECT
        count(tracker_id) trackerCount,
        sum(task_count) taskCount,
        sum(repay_count) repayCount,
        sum(repay_count) repayCountPercent,
        sum(repay_amount) repayAmount,
        sum(repay_amount_percent) repayAmountPercent
        FROM
        total_task_info
        where is_deleted=0

    </select>







    <select id="queryTaskInfoByTrackerIds" resultType="cn.tdw.dto.TaskInfoDTO">

        SELECT
        <include refid="TotalTaskInfoColumn"/>
        from total_task_info
        WHERE tracker_id in
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>

    </select>

    <insert id="batchInsertTaskInfo">
        INSERT INTO total_task_info(
        tracker_id,
        task_count,
        task_amount,
        repay_count,
        repay_count_percent,
        repay_amount,
        repay_amount_percent

        )VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.trackerId},
            #{item.taskCount},
            #{item.taskAmount},
            #{item.repayCount},
            #{item.repayCountPercent},
            #{item.repayAmount},
            #{item.repayAmountPercent})
        </foreach>

    </insert>

    <update id="batchUpdateTaskInfo">
        <foreach collection="list" item="item" separator=";">
            UPDATE total_task_info SET

            task_count=#{item.taskCount},
            task_amount=#{item.taskAmount},
            repay_count=#{item.repayCount},
            repay_count_percent=#{item.repayCountPercent},
            repay_amount=#{item.repayAmount},
            repay_amount_percent=#{item.repayAmountPercent}
            <where>
                AND tracker_id =#{item.trackerId}
            </where>
        </foreach>

    </update>

</mapper>